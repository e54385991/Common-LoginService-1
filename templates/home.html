<!DOCTYPE html>
<html lang="{{.lang}}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{t .lang "nav.home"}} - {{t .lang "app.name"}}</title>
    <!-- Inline script to prevent white flash on page load -->
    <script>
        (function() {
            var serverDarkMode = '{{.darkMode}}';
            var theme = 'light';
            if (serverDarkMode === 'dark') {
                theme = 'dark';
            } else if (serverDarkMode === 'light') {
                theme = 'light';
            } else {
                var stored = localStorage.getItem('dark-mode-preference');
                if (stored !== null) {
                    theme = stored === 'true' ? 'dark' : 'light';
                } else if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                    theme = 'dark';
                }
            }
            document.documentElement.setAttribute('data-theme', theme);
            window.serverDarkModeSetting = serverDarkMode;
        })();
    </script>
    <link href="/static/vendor/bootstrap/bootstrap.min.css" rel="stylesheet">
    <link href="/static/vendor/bootstrap-icons/bootstrap-icons.min.css" rel="stylesheet">
    <link href="/static/css/style.css" rel="stylesheet">
    <style>
        .service-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.15) !important;
        }
    </style>
    {{if .custom.GlobalCSS}}<style>{{.custom.GlobalCSS}}</style>{{end}}
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="/">
                <i class="bi bi-shield-lock-fill me-2"></i>{{t .lang "app.name"}}
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    {{if .logged}}
                    <li class="nav-item">
                        <a class="nav-link" href="/profile"><i class="bi bi-person me-1"></i>{{t .lang "nav.profile_center"}}</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/recharge"><i class="bi bi-wallet2 me-1"></i>{{t .lang "nav.recharge"}}</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/vip"><i class="bi bi-gem me-1"></i>{{t .lang "nav.vip"}}</a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button" data-bs-toggle="dropdown">
                            {{if .user.Avatar}}
                            <img src="{{.user.Avatar}}" alt="Avatar" class="rounded-circle me-1" width="24" height="24">
                            {{else}}
                            <i class="bi bi-person-circle me-1"></i>
                            {{end}}
                            {{.user.DisplayName}}
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li><a class="dropdown-item" href="/profile"><i class="bi bi-person me-2"></i>{{t .lang "nav.profile_center"}}</a></li>
                            <li><a class="dropdown-item" href="/recharge"><i class="bi bi-wallet2 me-2"></i>{{t .lang "nav.recharge_center"}}</a></li>
                            <li><a class="dropdown-item" href="/vip"><i class="bi bi-gem me-2"></i>{{t .lang "nav.vip_member"}}</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="#" onclick="logout()"><i class="bi bi-box-arrow-right me-2"></i>{{t .lang "nav.logout"}}</a></li>
                        </ul>
                    </li>
                    {{else}}
                    <li class="nav-item">
                        <a class="nav-link" href="/auth/login"><i class="bi bi-box-arrow-in-right me-1"></i>{{t .lang "nav.login"}}</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/auth/register"><i class="bi bi-person-plus me-1"></i>{{t .lang "nav.register"}}</a>
                    </li>
                    {{end}}
                    <!-- Dark Mode Toggle -->
                    <li class="nav-item">
                        <a class="nav-link dark-mode-toggle" href="javascript:void(0)" onclick="toggleDarkMode()" title="Toggle Dark Mode">
                            <i class="bi bi-moon-fill"></i>
                        </a>
                    </li>
                    <!-- Language Switcher -->
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="langDropdown" role="button" data-bs-toggle="dropdown">
                            <i class="bi bi-globe me-1"></i>{{if eq .lang "zh"}}中文{{else}}English{{end}}
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li><a class="dropdown-item {{if eq .lang "en"}}active{{end}}" href="#" onclick="setLanguage('en')"><i class="bi bi-check2 me-2 {{if ne .lang "en"}}invisible{{end}}"></i>English</a></li>
                            <li><a class="dropdown-item {{if eq .lang "zh"}}active{{end}}" href="#" onclick="setLanguage('zh')"><i class="bi bi-check2 me-2 {{if ne .lang "zh"}}invisible{{end}}"></i>中文</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="hero-section">
        <div class="container">
            <div class="row align-items-center min-vh-75">
                <div class="col-lg-6">
                    <h1 class="display-4 fw-bold mb-4">{{t .lang "home.hero.title"}}</h1>
                    <p class="lead mb-4">{{t .lang "home.hero.description"}}</p>
                    {{if not .logged}}
                    <div class="d-flex gap-3">
                        <a href="/auth/register" class="btn btn-primary btn-lg">
                            <i class="bi bi-rocket-takeoff me-2"></i>{{t .lang "home.hero.start"}}
                        </a>
                        <a href="#features" class="btn btn-outline-primary btn-lg">
                            <i class="bi bi-arrow-down me-2"></i>{{t .lang "home.hero.learn"}}
                        </a>
                    </div>
                    {{else}}
                    <div class="welcome-card">
                        <div class="d-flex align-items-center mb-3">
                            {{if .user.Avatar}}
                            <img src="{{.user.Avatar}}" alt="Avatar" class="rounded-circle me-3" width="64" height="64">
                            {{else}}
                            <div class="avatar-placeholder me-3">
                                <i class="bi bi-person-fill"></i>
                            </div>
                            {{end}}
                            <div>
                                <h4 class="mb-1">{{t .lang "home.welcome"}}{{if eq .lang "zh"}}，{{else}}, {{end}}{{.user.DisplayName}}!</h4>
                                <p class="mb-0 text-muted">{{.user.Email}}</p>
                            </div>
                        </div>
                        <div class="d-flex gap-2 flex-wrap">
                            <a href="/profile" class="btn btn-outline-primary">
                                <i class="bi bi-person me-1"></i>个人中心
                            </a>
                            <a href="/recharge" class="btn btn-success">
                                <i class="bi bi-wallet2 me-1"></i>充值中心
                            </a>
                            <a href="/vip" class="btn btn-warning">
                                <i class="bi bi-gem me-1"></i>开通VIP
                            </a>
                        </div>
                    </div>
                    {{end}}
                </div>
                <div class="col-lg-6 text-center">
                    <div class="hero-illustration">
                        <i class="bi bi-shield-check"></i>
                    </div>
                </div>
            </div>
        </div>
    </section>

    {{if .logged}}
    <!-- Quick Services Section for Logged In Users -->
    <section class="py-5 bg-light">
        <div class="container">
            <h2 class="text-center mb-2">快捷服务</h2>
            <p class="text-center text-muted mb-5">一站式管理您的账户、余额和会员权益</p>
            <div class="row g-4 justify-content-center">
                <div class="col-md-4">
                    <a href="/recharge" class="text-decoration-none">
                        <div class="card h-100 border-0 shadow-sm service-card" style="transition: transform 0.3s, box-shadow 0.3s;">
                            <div class="card-body text-center p-4">
                                <div class="rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="width: 80px; height: 80px; background: linear-gradient(135deg, #28a745 0%, #20c997 100%);">
                                    <i class="bi bi-wallet2 text-white" style="font-size: 2rem;"></i>
                                </div>
                                <h4 class="text-dark mb-2">充值中心</h4>
                                <p class="text-muted mb-3">为您的账户充值，支持多种支付方式</p>
                                <span class="btn btn-outline-success">
                                    <i class="bi bi-plus-circle me-2"></i>立即充值
                                </span>
                            </div>
                        </div>
                    </a>
                </div>
                <div class="col-md-4">
                    <a href="/vip" class="text-decoration-none">
                        <div class="card h-100 border-0 shadow-sm service-card" style="transition: transform 0.3s, box-shadow 0.3s;">
                            <div class="card-body text-center p-4">
                                <div class="rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="width: 80px; height: 80px; background: linear-gradient(135deg, #ffd700 0%, #ffb300 100%);">
                                    <i class="bi bi-gem text-dark" style="font-size: 2rem;"></i>
                                </div>
                                <h4 class="text-dark mb-2">VIP会员</h4>
                                <p class="text-muted mb-3">开通VIP享受专属特权和优质服务</p>
                                <span class="btn btn-outline-warning text-dark">
                                    <i class="bi bi-gem me-2"></i>开通VIP
                                </span>
                            </div>
                        </div>
                    </a>
                </div>
                <div class="col-md-4">
                    <a href="/profile" class="text-decoration-none">
                        <div class="card h-100 border-0 shadow-sm service-card" style="transition: transform 0.3s, box-shadow 0.3s;">
                            <div class="card-body text-center p-4">
                                <div class="rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="width: 80px; height: 80px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                                    <i class="bi bi-person-badge text-white" style="font-size: 2rem;"></i>
                                </div>
                                <h4 class="text-dark mb-2">个人中心</h4>
                                <p class="text-muted mb-3">管理您的账户信息和查看权益</p>
                                <span class="btn btn-outline-primary">
                                    <i class="bi bi-person me-2"></i>进入中心
                                </span>
                            </div>
                        </div>
                    </a>
                </div>
            </div>
        </div>
    </section>
    {{end}}

    <!-- Features Section -->
    <section id="features" class="features-section py-5">
        <div class="container">
            <h2 class="text-center mb-5">{{t .lang "home.features.title"}}</h2>
            <div class="row g-4">
                <div class="col-md-4">
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="bi bi-google"></i>
                        </div>
                        <h5>{{t .lang "home.feature.google"}}</h5>
                        <p>{{t .lang "home.feature.google.desc"}}</p>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="bi bi-envelope-paper"></i>
                        </div>
                        <h5>{{t .lang "home.feature.email"}}</h5>
                        <p>{{t .lang "home.feature.email.desc"}}</p>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="bi bi-code-slash"></i>
                        </div>
                        <h5>{{t .lang "home.feature.api"}}</h5>
                        <p>{{t .lang "home.feature.api.desc"}}</p>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="bi bi-key"></i>
                        </div>
                        <h5>{{t .lang "home.feature.jwt"}}</h5>
                        <p>{{t .lang "home.feature.jwt.desc"}}</p>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="bi bi-gear"></i>
                        </div>
                        <h5>{{t .lang "home.feature.admin"}}</h5>
                        <p>{{t .lang "home.feature.admin.desc"}}</p>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="bi bi-shield-lock"></i>
                        </div>
                        <h5>{{t .lang "home.feature.security"}}</h5>
                        <p>{{t .lang "home.feature.security.desc"}}</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- API Documentation Section -->
    <section class="api-section py-5 bg-light">
        <div class="container">
            <h2 class="text-center mb-5">{{t .lang "home.api.title"}}</h2>
            <div class="row">
                <div class="col-lg-8 mx-auto">
                    <div class="api-card">
                        <div class="api-endpoint">
                            <span class="method post">POST</span>
                            <code>/api/auth/register</code>
                            <span class="badge bg-secondary ms-2">{{t .lang "home.api.register"}}</span>
                        </div>
                        <div class="api-endpoint">
                            <span class="method post">POST</span>
                            <code>/api/auth/login</code>
                            <span class="badge bg-secondary ms-2">{{t .lang "home.api.login"}}</span>
                        </div>
                        <div class="api-endpoint">
                            <span class="method post">POST</span>
                            <code>/api/auth/logout</code>
                            <span class="badge bg-secondary ms-2">{{t .lang "home.api.logout"}}</span>
                        </div>
                        <div class="api-endpoint">
                            <span class="method get">GET</span>
                            <code>/api/auth/profile</code>
                            <span class="badge bg-secondary ms-2">{{t .lang "home.api.profile"}}</span>
                        </div>
                        <div class="api-endpoint">
                            <span class="method post">POST</span>
                            <code>/api/auth/validate</code>
                            <span class="badge bg-secondary ms-2">{{t .lang "home.api.validate"}}</span>
                        </div>
                        <div class="api-endpoint">
                            <span class="method post">POST</span>
                            <code>/api/auth/forgot-password</code>
                            <span class="badge bg-secondary ms-2">{{t .lang "home.api.forgot"}}</span>
                        </div>
                        <div class="api-endpoint">
                            <span class="method post">POST</span>
                            <code>/api/auth/reset-password</code>
                            <span class="badge bg-secondary ms-2">{{t .lang "home.api.reset"}}</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer py-4 bg-dark text-white">
        <div class="container text-center">
            {{if .custom.FooterText}}<p class="mb-0">{{.custom.FooterText}}</p>{{else}}<p class="mb-0">&copy; 2024 {{t .lang "app.name"}}. {{t .lang "home.footer"}}</p>{{end}}
        </div>
    </footer>

    {{if .logged}}
    <!-- Profile Modal -->
    <div class="modal fade" id="profileModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="bi bi-person me-2"></i>{{t .lang "profile.title"}}</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="text-center mb-4">
                        {{if .user.Avatar}}
                        <img src="{{.user.Avatar}}" alt="Avatar" class="rounded-circle mb-3" width="100" height="100">
                        {{else}}
                        <div class="avatar-placeholder-lg mb-3">
                            <i class="bi bi-person-fill"></i>
                        </div>
                        {{end}}
                        <h4>{{.user.DisplayName}}</h4>
                        <p class="text-muted">@{{.user.Username}}</p>
                    </div>
                    <div class="profile-info">
                        <div class="info-item">
                            <i class="bi bi-envelope text-muted me-2"></i>
                            <span>{{.user.Email}}</span>
                        </div>
                        <div class="info-item">
                            <i class="bi bi-calendar text-muted me-2"></i>
                            <span>{{t .lang "profile.registered"}} {{.user.CreatedAt.Format "2006-01-02"}}</span>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">{{t .lang "profile.close"}}</button>
                </div>
            </div>
        </div>
    </div>
    {{end}}

    <script src="/static/vendor/bootstrap/bootstrap.bundle.min.js"></script>
    <script src="/static/js/app.js"></script>
    <script>
        async function logout() {
            try {
                await fetch('/api/auth/logout', { method: 'POST' });
                window.location.href = '/auth/login';
            } catch (error) {
                console.error('Logout error:', error);
            }
        }
    </script>
    {{if .custom.GlobalHTML}}{{.custom.GlobalHTML}}{{end}}
</body>
</html>
